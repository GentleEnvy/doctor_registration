<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../static/css/style_rec.css">
    <title>Записаться к врачу</title>
</head>
<body>
<header>
    Записаться к врачу
</header>
<div class="container_rec">
    <div class="status">
        {{ doctor.surname }} {{ doctor.name }} {{ doctor.mid_name or '' }}
        <div class="stat">
            <div class="stat1"></div>
            - Запись свободна
        </div>
        <div class="stat">
            <div class="stat2"></div>
            - Запись занята
        </div>
        <div class="stat">
            <div class="stat3"></div>
            - Выходной
        </div>
        <div class="stat">
            <div class="stat4"></div>
            - Запись занята Вами
        </div>
    </div>
    <table class="table">
        <thead>
        <tr>
            <td>Дата</td>
            <td>День недели</td>
            <td>Запись</td>
        </tr>
        </thead>
        <tbody>
        {% for i in range(7) %}
            {% set now = today + timedelta(i) %}
            <tr>
                <td>{{ now.strftime('%d.%m.%Y') }}</td>
                <td>
                    {% if now.weekday() == 0 %}
                        Понедельник
                    {% elif now.weekday() == 1 %}
                        Вторник
                    {% elif now.weekday() == 2 %}
                        Среда
                    {% elif now.weekday() == 3 %}
                        Четверг
                    {% elif now.weekday() == 4 %}
                        Пятница
                    {% elif now.weekday() == 5 %}
                        Суббота
                    {% elif now.weekday() == 6 %}
                        Воскресенье
                    {% endif %}
                </td>
                {% set record_times = RecordTime.query.filter_by(
                    doctor=doctor, weekday=now.weekday()
                ).all() %}
                {% if record_times | length > 0 %}
                    <td>
                        <ol>
                            {% for record_time in record_times %}
                                {% set appointment = record_time.get_appointment(now) %}
                                <li class="
                                    {% if appointment %}
                                        {% if appointment.patient.id == current_user.id %}
                                            vac
                                        {% else %}
                                            busy
                                        {% endif %}
                                    {% else %}
                                        free
                                    {% endif %}
                                ">
                                    <a href="/signup/appointment?doctor={{ doctor.id }}&date={{ now.isoformat() }}">
                                        {{ record_time.start.strftime('%H:%M') }}-{{ record_time.end.strftime('%H:%M') }}
                                    </a>
                                </li>
                            {% endfor %}
                        </ol>
                    </td>
                {% else %}
                    <td class="off">Выходной</td>
                {% endif %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <div class="nav">
        <a href="/doctors" class="btn">Все специалисты</a>
        <a href="/" class="btn">Вернуться на главную</a>
    </div>
</div>
</body>
</html>